
<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pencatatan Poin Pelanggaran - SMP Malika Islamic Boarding School</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://css.gg/css?=|user-list" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .backdrop-blur-sm {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-400 to-indigo-600 min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-6xl mx-auto bg-white/90 backdrop-blur-sm rounded-2xl shadow-2xl overflow-hidden flex flex-col lg:flex-row">
        
        <!-- Kolom Kiri: Form Input Data -->
        <div class="w-full lg:w-1/2 p-6 md:p-8 border-b lg:border-b-0 lg:border-r border-gray-200">
            <div class="flex flex-col items-center text-center mb-6">
                <img src="https://iili.io/FsLlXA7.png" alt="Logo SMP Malika Islamic Boarding School" class="w-24 h-24 mb-4 object-cover rounded-full shadow-md" onerror="this.onerror=null;this.src='https://placehold.co/96x96/e0e0e0/757575?text=Logo';">
                <h1 class="text-2xl font-bold text-gray-800">Sistem Pencatatan Poin Pelanggaran</h1>
                <div class="mt-1">
                    <p class="text-gray-600">Santri Kelas VII. B Putri SMP</p>
                    <p class="font-bold text-lg text-blue-600">Malika Islamic Boarding School</p>
                </div>
            </div>

            <form id="violationForm" class="space-y-4">
                <div>
                    <label for="namaSantri" class="block text-sm font-medium text-gray-700 mb-1">Nama Santri</label>
                    <select id="namaSantri" name="namaSantri" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition bg-white" required>
                        <option value="" disabled selected>-- Pilih Nama Santri --</option>
                    </select>
                </div>

                <div>
                    <label for="jenisPelanggaran" class="block text-sm font-medium text-gray-700 mb-1">Jenis Pelanggaran</label>
                    <select id="jenisPelanggaran" name="jenisPelanggaran" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition bg-white" required>
                        <option value="" disabled selected>-- Pilih Jenis Pelanggaran --</option>
                    </select>
                </div>

                <div>
                    <label for="poinPelanggaran" class="block text-sm font-medium text-gray-700 mb-1">Poin Pelanggaran</label>
                    <input type="number" id="poinPelanggaran" name="poinPelanggaran" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 transition" placeholder="Poin akan terisi otomatis" readonly required>
                </div>

                <div>
                    <label for="tanggalPelanggaran" class="block text-sm font-medium text-gray-700 mb-1">Tanggal Pelanggaran</label>
                    <input type="date" id="tanggalPelanggaran" name="tanggalPelanggaran" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition" required>
                </div>

                <div>
                    <label for="keterangan" class="block text-sm font-medium text-gray-700 mb-1">Keterangan Tambahan (Waktu, Saksi, Kronologi)</label>
                    <textarea id="keterangan" name="keterangan" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition" placeholder="Contoh: Terlambat saat apel pagi, disaksikan oleh Ustadz Fulan"></textarea>
                </div>

                <div>
                    <label for="kodeMusyrif" class="block text-sm font-medium text-gray-700 mb-1">Kode Musyrif</label>
                    <input type="text" id="kodeMusyrif" name="kodeMusyrif" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition" placeholder="Masukkan kode Anda" required>
                </div>

                <button type="submit" id="submitButton" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 flex items-center justify-center">
                    <svg id="submitIcon" class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span id="submitText">Simpan Data</span>
                    <svg id="loadingSpinner" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>

        <!-- Kolom Kanan: Rekap dan Pencarian -->
        <div class="w-full lg:w-1/2 p-6 md:p-8 flex flex-col">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Rekap Total Poin Santri</h2>
            
            <div class="mb-4">
                <label for="searchSantri" class="block text-sm font-medium text-gray-700 mb-1">Cari Nama Santri</label>
                <input type="search" id="searchSantri" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition" placeholder="Ketik nama untuk filter...">
            </div>

            <div id="rekapContainer" class="flex-grow bg-gray-50 rounded-lg p-4 overflow-y-auto h-96 lg:h-auto">
                <!-- Konten rekap akan di-generate oleh JavaScript -->
            </div>
        </div>
    </div>

    <!-- Custom Message Box -->
    <div id="messageBox" class="fixed top-5 right-5 bg-green-500 text-white py-3 px-5 rounded-lg shadow-lg transform translate-x-[120%] transition-transform duration-500">
        <p id="messageText"></p>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- KONFIGURASI ---
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyLwIvorYndFh-U6uwm_O1KBV15J4FKkLOtXPTf_D322YZq630WDBeSPxU8ytTCqjcM/exec';
        
        // --- DATABASE ---
        const SANTRI_LIST = [
           "Aesha Bellvania Kirana", "Aira Fitriani Azzahra", "Aisyah Fahira Husna", "Alya Zahra Nabila", "Ameera Isnain Setiadi", "Aulia Zahra Ibrahim", "Azizahtun Nazwa", "Ghina Bilqis Shabreen", "Hafizhah Alimah", "Haninda Aulia Dayana", "Hilma Arifa Aulia Rosid", "Jihan Amira Karim", "Keyla Khanza Ramadhani", "Nafisa Al Mahira", "Nailatisya Aquina Salsabilla", "Nilam Maulina Anggraini", "R A Najeela Putri Widiarsa", "Rhaqueena Aleameccha Alingga", "Salsabila Zovanka", "Shakila Aulia Sakhiy", "Shifa Mumtazah", "Siti Alifia Zahra", "Siti Zahwa Naura Auni", "Siti Ziarra Nur Al-Jaelani", "Syafa Savira", "Syakilah Putri Oktavia", "Syakirah Rizqia Ramadani", "Tuhfatun Najwa", "Vinca Fitranavira Putri", "Zhafira Nur Azzahra",
        ];

        const VIOLATION_TYPES = {
            "Pelanggaran Ringan (1-10 Poin)": {
                "Tidak mengucap salam ketika masuk kamar / kelas": 3,
                "Memakai cincin, gelang, kalung, anting (aksesoris tidak wajar)": 3,
                "Menggunakan perhiasan emas": 3,
                "Berhias berlebihan (lipstik, hena, kutek, blush on)": 3,
                "Telat tiba di kelas setelah KBM dimulai": 5,
                "Telat tiba di masjid setelah adzan berkumandang": 5,
                "Tidak mengikuti kegiatan wajib (Halaqoh, Ekstra, KBM) tanpa keterangan": 5,
                "Putri: tidak memakai singlet/dalaman jilbab": 5,
                "Putra: tidak memakai/membawa kaos dalaman seragam": 5,
                "Putra: baju tidak dimasukkan/ikat pinggang tidak rapi": 5,
                "Putra: tidak memakai ikat pinggang hitam (formal)": 5,
                "Tidak menggunakan kelengkapan seragam (rompi, dasi, jilbab pesantren)": 5,
                "Tidak memakai seragam olahraga pada waktunya": 5,
                "Memakai seragam tidak sesuai ketentuan (ketat/kebesaran/ngatung)": 5,
                "Memakai seragam tidak sesuai jadwal tanpa konfirmasi": 5,
                "Tidak memakai Almamater saat upacara Senin": 5,
                "Tidak memakai peci saat belajar": 5,
                "Model rambut putra tidak wajar (mohawk, skin, mulet)": 5,
                "Tidak ikut ulangan/ujian tanpa alasan jelas": 5,
                "Tidak melaksanakan tugas dari pesantren": 5,
                "Tidak ambil/kumpulkan Raport sesuai jadwal": 5,
                "Membuang sampah sembarangan": 5,
                "Tidur saat KBM berlangsung": 5,
                "Tidak melaksanakan piket kelas atau kamar": 5,
                "Telat kembali ke pesantren setelah liburan": 10,
                "Tidak mengikuti upacara tanpa alasan jelas": 10,
                "Mencoret-coret pakaian seragam sekolah": 10,
                "Melakukan kecurangan saat ulangan": 10,
                "Tidak menyampaikan surat edaran ke orang tua": 10,
                "Mengucap/menulis kata kotor ke sesama santri": 10,
                "Berada di luar pesantren saat KBM/istirahat tanpa izin": 10,
                "Membuat kegaduhan": 10,
            },
            "Pelanggaran Sedang (15-49 Poin)": {
                "Bolos/kabur pada saat KBM/kegiatan pesantren": 15,
                "Mengucap/menulis kata tidak sopan ke orang tua/guru": 20,
                "Mencoret-coret sarana dan prasarana Pesantren": 20,
                "Membawa HP / alat elektronik lainnya": 20,
                "Merusak benda milik orang lain/pesantren": 20,
            },
            "Pelanggaran Berat (50+ Poin)": {
                "Melakukan perbuatan asusila (onani, dll)": 50,
                "Ditindik (putri selain di telinga)": 50,
                "Mencemarkan nama baik santri/guru/pesantren": 50,
                "Berpacaran": 50,
                "Bermusuhan/memprovokasi/berkelahi": 50,
                "Merokok (konvensional/elektrik)": 50,
                "Terlibat perkelahian ringan (tanpa luka fisik)": 50,
                "Mengancam santri/guru/pegawai": 75,
                "Intimidasi (Bullying)/memalak sesama santri": 75,
                "Membawa senjata tajam/api": 75,
                "Melakukan penyimpangan seksual / LGBT": 100,
                "Terlibat tindak kriminalitas": 100,
                "Terlibat perkelahian berat (menimbulkan luka fisik)": 100,
            }
        };

        // --- ELEMEN DOM ---
        const form = document.getElementById('violationForm');
        const namaSantriSelect = document.getElementById('namaSantri');
        const jenisPelanggaranSelect = document.getElementById('jenisPelanggaran');
        const poinPelanggaranInput = document.getElementById('poinPelanggaran');
        const tanggalPelanggaranInput = document.getElementById('tanggalPelanggaran');
        const rekapContainer = document.getElementById('rekapContainer');
        const searchInput = document.getElementById('searchSantri');
        const submitButton = document.getElementById('submitButton');
        const submitText = document.getElementById('submitText');
        const submitIcon = document.getElementById('submitIcon');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');

        // --- STATE APLIKASI ---
        let allRecords = [];

        // --- FUNGSI-FUNGSI ---

        function showMessage(message, isError = false) {
            messageText.textContent = message;
            messageBox.classList.remove(isError ? 'bg-green-500' : 'bg-red-500', !isError ? 'bg-red-500' : 'bg-green-500');
            messageBox.classList.add(isError ? 'bg-red-500' : 'bg-green-500');
            messageBox.classList.remove('translate-x-[120%]');
            setTimeout(() => { messageBox.classList.add('translate-x-[120%]'); }, 3000);
        }

        function populateSantriList() {
            SANTRI_LIST.sort().forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                namaSantriSelect.appendChild(option);
            });
        }

        function populateViolationTypes() {
            for (const category in VIOLATION_TYPES) {
                const optgroup = document.createElement('optgroup');
                optgroup.label = category;
                for (const violation in VIOLATION_TYPES[category]) {
                    const option = document.createElement('option');
                    option.value = violation;
                    option.textContent = violation;
                    optgroup.appendChild(option);
                }
                jenisPelanggaranSelect.appendChild(optgroup);
            }
        }

        function updatePoin() {
            const selectedViolation = jenisPelanggaranSelect.value;
            let points = '';
            for (const category in VIOLATION_TYPES) {
                if (VIOLATION_TYPES[category][selectedViolation]) {
                    points = VIOLATION_TYPES[category][selectedViolation];
                    break;
                }
            }
            poinPelanggaranInput.value = points;
        }

        function updateRekap() {
            const searchTerm = searchInput.value.toLowerCase();
            rekapContainer.innerHTML = ''; // Kosongkan kontainer
            
            const pointTotals = {};
            // Inisialisasi semua santri dari database dengan 0 poin
            SANTRI_LIST.forEach(name => {
                pointTotals[name] = 0;
            });

            // Akumulasi poin dari catatan pelanggaran
            allRecords.forEach(record => {
                const name = record.namaSantri.trim();
                const points = parseInt(record.poinPelanggaran, 10);
                if (pointTotals.hasOwnProperty(name)) {
                    pointTotals[name] += points;
                } else {
                    // Jika ada nama yg tidak ada di list, tetap tampilkan
                    pointTotals[name] = points;
                }
            });

            // Filter dan urutkan
            const filteredAndSortedSantri = Object.entries(pointTotals)
                .filter(([name]) => name.toLowerCase().includes(searchTerm))
                .sort(([, a], [, b]) => b - a);
            
            if (filteredAndSortedSantri.length === 0) {
                 rekapContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-gray-400 p-4 text-center">
                        <i class="gg-user-list" style="--ggs:2; margin-bottom: 1rem;"></i>
                        <p>${allRecords.length === 0 ? 'Belum ada data pelanggaran.' : 'Tidak ada santri yang cocok dengan pencarian.'}</p>
                    </div>`;
                return;
            }

            filteredAndSortedSantri.forEach(([name, totalPoints]) => {
                const rekapItem = document.createElement('div');
                rekapItem.className = 'flex justify-between items-center p-3 mb-2 bg-white rounded-lg shadow-sm hover:bg-blue-50 transition';
                
                const pointColor = totalPoints >= 100 ? 'text-red-600' : totalPoints >= 50 ? 'text-yellow-600' : 'text-gray-700';
                const pointWeight = totalPoints > 0 ? 'font-bold' : 'font-normal';
                
                rekapItem.innerHTML = `
                    <span class="font-medium text-gray-800">${name}</span>
                    <span class="${pointWeight} text-lg ${pointColor}">${totalPoints} Poin</span>
                `;
                rekapContainer.appendChild(rekapItem);
            });
        }

        async function handleFormSubmit(event) {
            event.preventDefault();
            
            submitText.textContent = 'Mengirim...';
            submitIcon.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            submitButton.disabled = true;

            const formData = new FormData(form);
            const record = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: formData });
                const result = await response.json();

                if (result.result === 'success') {
                    showMessage('Data pelanggaran berhasil disimpan!');
                    allRecords.push(record);
                    updateRekap();
                    form.reset();
                    poinPelanggaranInput.value = '';
                    tanggalPelanggaranInput.valueAsDate = new Date();
                } else {
                    throw new Error(result.message || 'Gagal mengirim data. Coba lagi.');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage(error.message || 'Terjadi kesalahan jaringan.', true);
            } finally {
                submitText.textContent = 'Simpan Data';
                submitIcon.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                submitButton.disabled = false;
            }
        }

        // --- INISIALISASI & EVENT LISTENERS ---
        populateSantriList();
        populateViolationTypes();
        tanggalPelanggaranInput.valueAsDate = new Date();
        updateRekap();

        jenisPelanggaranSelect.addEventListener('change', updatePoin);
        form.addEventListener('submit', handleFormSubmit);
        searchInput.addEventListener('input', updateRekap);
    });
</script>

</body>
</html>


